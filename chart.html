<!DOCTYPE html>
<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

  <style>
    body,
    html {
      background-color: #000000;
      color: #FFFFFF;
      margin: 0px;
      padding: 0px;
      overflow: hidden;
    }

    a:link,
    a:visited {
      background-color: black;
      color: white;
    }

    a:hover,
    a:active {
      background-color: white;
      color: black;
    }

    .flex-container {
      display: flex;
      background-color: #000000;
    }

    .ticker-tape {
      height: 30px;
      background-color: #FFFFFF;
      color: #000000;
      text-align: center;
      border: 3px solid #555555;
    }

    .search {
      width: 100%;
      height: 5px;
      background-color: #000000;
      color: gray;
      text-indent: 30px;
      font-size: 90%;
      padding: 2rem;
      border: 3px solid #555555;
    }

    /* First column */
    .met {
      width: 30%;
      height: 400px;
      background-color: #000000;
      color: #FFFFFF;
      padding: 1%;
      text-align: center;
      border: 1px solid #FFFFFF;
    }

    .chart {
      position: wrap;
      width: 40%;
      height: 600px;
      background-color: #000000;
      color: #FFFFFF;
      border: 3px solid #000000;
    }

    .fin {
      width: 280%;
      height: 400px;
      background-color: #000000;
      color: #FFFFFF;
      padding: 1%;
      text-align: center;
      border: 1px solid #FFFFFF;
      position: relative;
    }

    .rightbox {
      position: relative;
    }
  </style>
</head>

<body>
  <div class="ticker-tape">
    <p>UNP 154.2</p>
  </div>

  <input type="text" class="search" autocomplete="off" id="search" onkeydown="esckeyPressed(event, this);"
    placeholder="Search a stock or commodity..." value="HISTCHART:"></input>

  <div class="flex-container">

    <div id="chart"></div>

  </div>
</body>
<script>
  function esckeyPressed(event, input) {
    var code = event.charCode || event.keyCode; //Read key input
    if (code == 27) {                          //If esc key is pressed
      input.value = '';  //clear the search box
    }
  }

  window.addEventListener('DOMContentLoaded', (event) => {
    let cont = window.location.hash.slice(1);
    console.log(cont);

    var title;
    if (cont == "NYSE") {
      var titl = 'New York Stock Exchange Composite (1865-2023)';
      var url = 'http://localhost:3000/public/usa/' + cont + '.json';
      title = 'Stock Index';

    } else if (cont == "SPSE") {
      var titl = 'Saint Petersburg Stock Exchange Index (1865-2023)';
      var url = 'http://localhost:3000/public/russia/' + cont + '.json';
      title = 'Stock Index';
    } else if (cont == "RUS_INDPRO") {
      var titl = 'Russia Industrial Production Index (1860-2023)';
      var url = 'http://localhost:3000/public/russia/' + cont + '.json';
      title = 'Industrial Production';
    } else if (cont == "RUS_GDP") {
      var titl = 'Russia National Income (1885-2021)';
      var url = 'http://localhost:3000/public/russia/' + cont + '.json';
      title = 'GDP';
    } else {
      console.log("no data specified");
    }
    $.getJSON(url, function (response) {

      console.log(response);
      var options = {
        series: [{
          name: [title],
          data: response.map(item => {

            var first;
            var second;
            if (cont == "NYSE") {
              first = item.month;
              second = item[cont];
            } else if (cont == "SPSE") {
              first = item.month;
              second = item[cont];
            } else if (cont == "RUS_INDPRO" || cont == "RUS_GDP") {
              first = item.year;
              second = item.index;

            } else {
              console.log("no data specified");
            }

            return [first, second]
          })
        }],
        chart: {
          type: 'area',
          foreColor: "#FFFFFF",

          stacked: false,
          height: 650,
          width: 1590,
          zoom: {
            type: 'x',
            enabled: true,
            autoScaleYaxis: true
          },
          toolbar: {
            autoSelected: 'zoom'
          }
        },
        dataLabels: {
          enabled: false,
        },
        markers: {
          size: 0,
        },
        title: {
          text: titl,
          align: 'left'
        },
        fill: {
          type: 'gradient',
          gradient: {
            shadeIntensity: 1,
            inverseColors: false,
            opacityFrom: 0.5,
            opacityTo: 0,
            stops: [0, 90, 100]
          },
        },
        yaxis: {
          labels: {
            formatter: function (val) {
              return val
            },
          },
          title: {
            text: 'Price'
          },
        },
        xaxis: {
          type: 'datetime',
        },
        tooltip: {
          shared: false,
          theme: 'dark',
          fillSeriesColor: true,
          y: {
            formatter: function (val) {
              return val
            }
          }
        }
      };
      var chart = new ApexCharts(document.querySelector("#chart"), options);
      chart.render();

    });
  });




</script>

</html>